<!--
   
   Copyright (c) 2017, the Perspective Authors.
   
   This file is part of the Perspective library, distributed under the terms of
   the Apache License 2.0.  The full license can be found in the LICENSE file.

-->

<!DOCTYPE html>
<html>

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel='stylesheet' href="/css/datagrid/material-dense.dark.css">
    <link rel='stylesheet' href="/css/datagrid/index.css"> 
  
    <script src="https://unpkg.com/@finos/perspective-viewer-d3fc"></script>
    <script src="https://unpkg.com/@finos/perspective-viewer"></script>

    <script src="perspective-viewer-datagrid.js"></script>    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Orbitron">
  
<style>

@import url(https://fonts.googleapis.com/css?family=Material+Icons);
@import url(https://fonts.googleapis.com/css?family=Open+Sans);
@import url(https://fonts.googleapis.com/css?family=Roboto+Mono);
/******************************************************************************
 *
 * Copyright (c) 2017, the Perspective Authors.
 *
 * This file is part of the Perspective library, distributed under the terms of
 * the Apache License 2.0.  The full license can be found in the LICENSE file.
 *
 */
perspective-viewer,
.perspective-viewer-material-dense-dark {
  font-family: "Open Sans";
  --interface-monospace--font-family: "Roboto Mono";
  --inactive-column-selector--content: "\E835";
  --active-column-selector--content: "\E834";
  --column--background: none;
  --column--height: 21px;
  --active-column--height: 51px;
  --inactive-column--height: 24px;
  --active-columns--justify-content: space-evenly;
  --inactive-column--opacity: 0.3;
  --float--column-type--color: #1a7da1;
  --string--column-type--color: #ff8888;
  --settings-button--content: "more_vert";
  --button--font-family: "Material Icons";
  --overflow_hint--before: "error_outline";
  --overflow_hint--font-family: "Material Icons";
  --overflow_hint--color: rgba(0, 0, 0, 0.2);
  --overflow_hint--padding: 0 12px 0 6px;
  --copy_button--before: "file_copy";
  --download_button--before: "save_alt";
  --reset_button--before: "refresh";
  --row_draggable-border-last-child-width: 0;
  --row_pivots--before: "Group By";
  --column_pivots--before: "Split By";
  --sort-order-asc--before: "arrow_upward";
  --sort-order-desc--before: "arrow_downward";
  --sort-order-none--before: "remove";
  --close_button--before: "close";
  --sort-order-col-asc--before: "arrow_back";
  --sort-order-col-desc--before: "arrow_forward";
  --select--background-color: none;
  --select--padding: 0px;
  --column-drop-container--background: none;
  --column-drop-container--padding: 0px;
  --column-drop-container--margin: 24px 24px 0px 0px;
  --column-drop-label--margin: -12px 0px 0px 0px;
  --column-drop-label--font-size: 10px;
  --column-drop-label--display: inline-block;
  --column-container--margin: 24px 0px 0px 0px;
  --column-add--font-family: "Material Icons";
  --column-add--before: "add";
  --column_type--padding: 0px 0px 0px 0px;
  --column_type--width: 25px;
  --column-selector--font-family: "Material Icons";
  --active-column-selector--height: 45px;
  --column_selector--width: 31px;
  --column_selector--font-size: 16px;
  --hypergrid-gridline--color: #ddd;
  --hypergrid--padding: 24px;
  --side_panel--padding: 24px 24px 24px 17px;
  --button--padding: 24px 17px 0px 17px;
  --button--font-size: 16px;
  --top_panel--padding: 0px 0px 24px 0px;
  --top-panel-row--display: inline-flex;
  --hypergrid-scrollbar--width: 8px;
  --hypergrid-scrollbar--border-radius: 5px;
  --hypergrid--font-size: 12px;
  --hypergrid-header--font-size: 12px;
  --hypergrid--font-family: "Open Sans";
  --hypergrid-header--font-family: "Open Sans";
  --d3fc-treedata-axis--lines: none;
  background-color: #2a2c2f;
  color: #cfd8dc;
  --plugin--background: #2f3136;
  --select--background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIwLjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCA0LjkgMTAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQuOSAxMDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM0NDQ0NDQ7fQo8L3N0eWxlPgo8dGl0bGU+YXJyb3dzPC90aXRsZT4KPHBvbHlnb24gY2xhc3M9InN0MCIgcG9pbnRzPSIxLjQsNC43IDIuNSwzLjIgMy41LDQuNyAiLz4KPHBvbHlnb24gY2xhc3M9InN0MCIgcG9pbnRzPSIzLjUsNS4zIDIuNSw2LjggMS40LDUuMyAiLz4KPC9zdmc+Cg==) no-repeat 95% 50%;
  --inactive--color: #666;
  --active--background: #135d78;
  --active--color: #22a0ce;
  --column_type-float--color: #22a0ce;
  --column_type-string--color: #ff8888;
  --hypergrid--color: #eee;
  --hypergrid-tree-header--background: #2f3136;
  --hypergrid--background: #2f3136;
  --hypergrid-tree-header--color: #eee;
  --hypergrid-header--background: #2f3136;
  --hypergrid-separator--color: #eee;
  --hypergrid-header--color: #eee;
  --hypergrid-selection--background: rgba(255, 255, 255, 0.25);
  --hypergrid-positive--color: #22a0ce;
  --hypergrid-negative--color: #ff8888;
  --hypergrid-row-hover--background: #555;
  --hypergrid-row-hover--color: #eee;
  --hypergrid-cell-hover--background: #444;
  --hypergrid-cell-hover--color: #eee;
  --highcharts-label--fill: #cfd8dc;
  --highcharts-rect--opacity: 0.85;
  --highcharts-grid-line--stroke: #3b3f46;
  --highcharts-tooltip--background: #2a2c2f;
  --d3fc-legend--text: #bbbbbb;
  --d3fc-treedata--labels: #bbbbbb;
  --d3fc-treedata--hover-highlight: #ffffff;
  --d3fc-axis--ticks: #bbbbbb;
  --d3fc-axis--lines: #555555;
  --d3fc-tooltip--background: #333333;
  --d3fc-tooltip--color: #cfd8dc;
  --d3fc-series: rgba(31, 119, 180, 0.8);
  --d3fc-series-1: #0366d6;
  --d3fc-series-2: #ff7f0e;
  --d3fc-series-3: #2ca02c;
  --d3fc-series-4: #d62728;
  --d3fc-series-5: #9467bd;
  --d3fc-series-6: #8c564b;
  --d3fc-series-7: #e377c2;
  --d3fc-series-8: #7f7f7f;
  --d3fc-series-9: #bcbd22;
  --d3fc-series-10: #17becf;
  --d3fc-full--gradient: linear-gradient(#feeb65 0%, #e4521b 22.5%, #4d342f 42.5%, #222222 50%, #1a237e 57.5%, #42b3d5 67.5%, #dcedc8 100%);
  --d3fc-positive--gradient: linear-gradient(#222222 0%, #1a237e 35%, #42b3d5 70%, #dcedc8 100%);
  --d3fc-negative--gradient: linear-gradient(#feeb65 0%, #e4521b 35%, #4d342f 70%, #222222 100%);
  --highcharts-full--gradient: linear-gradient(#feeb65 0%, #e4521b 22.5%, #4d342f 42.5%, #222222 50%, #1a237e 57.5%, #42b3d5 67.5%, #dcedc8 100%);
  --highcharts-positive--gradient: linear-gradient(#222222 0%, #1a237e 35%, #42b3d5 70%, #dcedc8 100%);
  --highcharts-negative--gradient: linear-gradient(#feeb65 0%, #e4521b 35%, #4d342f 70%, #222222 100%);
  --warning--color: #333;
  --hypergrid--padding: 12px 12px 12px 12px;
  --hypergrid-row--height: 20px;
  --side_panel--padding: 12px 12px 12px 10px;
  --top_panel--padding: 0px 0px 12px 0px;
  --column-drop-label--margin: -10px 0px 0px 0px;
  --column-drop-container--margin: 12px 12px 0px 0px;
  --column-container--margin: 12px 0px 0px 0px;
  --row_draggable--animation: none;
  --button--padding: 1px 9px;
  --active-column--height: 45px;
  --column-drop-label--font-size: 8px;
  --column_selector--width: 24px;
}


perspective-viewer {
     flex: 1;
}

body {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    margin: 0;
    padding: 0;
}

input {
    margin: 24px;
    max-width: 300px;
}

@media (max-width: 600px) {
    html {
        overflow: hidden;
    }

    body {
        position: fixed;
        height: 100%;
        width: 100%;
        margin: 0;
        overflow: hidden;
        touch-action: none;
    }
}
/*# sourceMappingURL=material-dense.dark.css.map*/
</style>
</head>

<body>

    <perspective-viewer plugin="datagrid" columns='["Profit", "Sub-Category",
    "State", "Sales", "Category", "Order Date", "Quantity"]'>

    </perspective-viewer>

    <script>


        function hue(value, min, max) {
            const norm = "0" + Math.abs(Math.round(255 * (Math.min(Math.max(value, min), max) / (max - min)))).toString(16);
            return norm.slice(norm.length - 2, norm.length);
        }

        window.addEventListener('WebComponentsReady', async function() {
            const viewer = document.getElementsByTagName('perspective-viewer')[0];
            const data = await fetch("/arrow/superstore.arrow");
            const arr = await data.arrayBuffer();
            viewer.load(arr.slice());
            viewer.toggleConfig();

            const CACHE = {}
            let max = -Infinity;

            viewer.addEventListener("perspective-config-update", () => {
                max = -Infinity;
            });

            viewer.addEventListener("perspective-datagrid-after-update", () => {

                const cache = Object.keys(CACHE).reduce((obj, key) => {
                    obj[key] = CACHE[key].slice();
                    return obj;
                }, {});

                
                for (const td of document.querySelectorAll("perspective-viewer td")) {
                    
                    const clean_name = td.value && td.value.trim && td.value.trim();
                    if (td.classList.contains("float")) {
                        if (td.value < 0) {
                            const fg = hue(Math.min(td.value, -50), -100, 0);
                            td.style.color = `#${fg}${fg}${fg}`;
                            td.style.background = `radial-gradient(#${hue(Math.min(td.value, -20), -100, 0)}3136, #243136`;;
                            td.style.border = `1px solid #${hue(Math.min(td.value / 3, -20), -100, 0)}3136`;;
                        } else if (td.value > 0) {
                            const fg = hue(Math.max(td.value, 50), 0, 100);
                            td.style.color = `#${fg}${fg}${fg}`;
                            td.style.background =  `radial-gradient(#24${hue(Math.max(20, td.value), 0, 100)}36, #243136`
                            td.style.border = `1px solid #24${hue(Math.max(td.value / 3, 20), 0, 100)}36`;;
                        } else {
                            td.style.color = "#000";
                            td.style.background = "";
                            td.style.border = ``;;
                        }
                    } else if (td.classList.contains("integer")) {
                        td.style.background = "";
                        td.style.border = ``;;
                        if (!td.value) {
                        } else {
                            max = Math.max(max, td.value || 0);
                            console.log(max)
                            let v = (td.value || 0) / max
                            td.innerHTML = `<div style="height:15px;width:${v * 100}%;background:linear-gradient(90deg, #2bb0af 0, #23a7d7);"><div>`;
                        }
                    } else if (states[clean_name]) {
                        td.style.background = "";
                        td.style.border = ``;;
                        if (cache[clean_name] && cache[clean_name].length > 0) {
                            const name = td.value;
                            td.textContent = "";
                            td.appendChild(cache[name].pop());
                        } else {
                            const name = td.value;
                            img = document.createElement("img");
                            img.setAttribute("src", `http://perspective.finos.org/img/flags/${states[clean_name].toLowerCase()}.png`);
                            img.setAttribute("height", "15");
                            td.textContent = "";
                            td.appendChild(img);
                            CACHE[name] = CACHE[name] || [];
                            CACHE[name].push(img);                           
                        }
                        
                    } else {
                        td.style.border = ``;;
                        td.style.background = "";
                        td.style.color = "";                
                    }
                }
            });            

            const states = {
                "Alabama": "AL",
                "Alaska": "AK",
                "Arizona": "AZ",
                "Arkansas": "AR",
                "California": "CA",
                "Colorado": "CO",
                "Connecticut": "CT",
                "District of Columbia": "DC",
                "Delaware": "DE",
                "Florida": "FL",
                "Georgia": "GA",
                "Hawaii": "HI",
                "Idaho": "ID",
                "Illinois": "IL",
                "Indiana": "IN",
                "Iowa": "IA",
                "Kansas": "KS",
                "Kentucky": "KY",
                "Louisiana": "LA",
                "Maine": "ME",
                "Maryland": "MD",
                "Massachusetts": "MA",
                "Michigan": "MI",
                "Minnesota": "MN",
                "Mississippi": "MS",
                "Missouri": "MO",
                "Montana": "MT",
                "Nebraska": "NE",
                "Nevada": "NV",
                "New Hampshire": "NH",
                "New Jersey": "NJ",
                "New Mexico": "NM",
                "New York": "NY",
                "North Carolina": "NC",
                "North Dakota": "ND",
                "Ohio": "OH",
                "Oklahoma": "OK",
                "Oregon": "OR",
                "Pennsylvania": "PA",
                "Rhode Island": "RI",
                "South Carolina": "SC",
                "South Dakota": "SD",
                "Tennessee": "TN",
                "Texas": "TX",
                "Utah": "UT",
                "Vermont": "VT",
                "Virginia": "VA",
                "Washington": "WA",
                "West Virginia": "WV",
                "Wisconsin": "WI",
                "Wyoming": "WY"
            };
        
        });
    </script>

    <style>
        td {       
            height: 24px;           
        }
        tr td.pd-group-header, tr th.pd-group-header {
            border-right: 1px solid #666 !important;
        }
        tbody:hover tr {
            opacity: 0.5;
            transition: opacity 0.2s ease-in;
        }
        tbody:hover tr:hover td div {
            transform: scaleX(1.3);
            transform-origin:0;
            transition: transform 0.2s ease-in;
        }
        tbody:hover tr:hover { 
            box-shadow: 0px 0px 20px rgba(0,0,0,0.4);
            opacity: 1;
            transition: none;
        } 
        tr:last-child th {
            border-bottom: 1px solid #666;
        }
        tr th {
            border-right: 1px solid #666;
        }
        tbody:hover tr:hover td { 
            background: none;
            opacity: 1;
        }
        tbody:hover tr:nth-child(even):hover td, tbody tr:nth-child(even) td {
            background: rgba(0,0,0,0.1);
        }
        td.float {
            text-align: center !important;
            font-family: Orbitron;
        }
        th.integer, td.integer {
            width: 100px;
        }
        
    </style>
</body>

</html>



